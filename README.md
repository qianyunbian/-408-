# Quicker 重构版本 - 完整功能指南

一个功能强大的悬浮快捷按钮工具，支持自定义动作、图标管理、多层级面板、输入输出脚本、快捷发送等丰富功能。

## 🌟 项目概述

Quicker是一个基于Python和PySide6开发的桌面自动化工具，提供了悬浮按钮、动作面板、脚本执行等功能，帮助用户提高日常工作效率。

### ✨ 核心特性

- **🎯 悬浮按钮系统**: 可拖拽、边缘吸附的智能悬浮按钮
- **📱 多层级动作面板**: 支持无限层级的动作组织
- **🔧 丰富的动作类型**: 按键模拟、程序运行、网址打开、文本发送、脚本执行等
- **🎨 SVG图标管理**: 完整的图标管理系统，支持自定义图标
- **⌨️ 全局热键支持**: 自定义热键快速调用功能
- **💾 智能配置管理**: 自动备份、版本控制、配置恢复
- **🔄 复制剪切粘贴**: 动作的跨面板管理和排序
- **🚀 快捷发送功能**: 管理常用文本和快捷键信息
- **🐍 Python脚本引擎**: 强大的输入输出自动化脚本系统

## 📁 项目结构

```
quiker/refactory_1/
├── main.py                     # 主程序入口
├── config.json                 # 主配置文件
├── README.md                   # 项目说明文档
├── src/                        # 源代码目录
│   ├── __init__.py
│   ├── config_manager.py       # 配置管理模块
│   ├── icon_manager.py         # 图标管理模块
│   ├── button_widget.py        # 按钮组件模块
│   ├── action_panel.py         # 动作面板模块
│   ├── floating_button.py      # 悬浮按钮模块
│   ├── icon_selector.py        # 图标选择器模块
│   ├── action_edit_dialog.py   # 动作编辑对话框
│   ├── input_output_dialog.py  # 输入输出动作创建对话框
│   ├── script_editor_dialog.py # 脚本编辑器对话框
│   ├── quick_send_panel.py     # 快捷发送面板
│   └── data_panel_dialog.py    # 数据面板对话框
├── svg/                        # SVG图标目录
│   ├── grid.svg               # 网格图标
│   ├── home.svg               # 主页图标
│   ├── search.svg             # 搜索图标
│   ├── file.svg               # 文件图标
│   ├── clipboard.svg          # 剪贴板图标
│   ├── arrow_up.svg           # 向上箭头图标
│   ├── sun.svg                # 太阳图标
│   ├── menu.svg               # 菜单图标
│   ├── check_circle.svg       # 选中圆圈图标
│   └── chevron_down.svg       # 向下箭头图标
├── config_backups/             # 配置备份文件夹
├── input_output_actions/       # 输入输出脚本文件夹
├── quick_send/                 # 快捷发送配置文件夹
└── data_panels/               # 数据面板配置文件夹
```

## 🚀 快速开始

### 环境要求
- Python 3.8+
- PySide6

### 必需依赖
```bash
pip install PySide6
```

### 可选依赖（增强功能）
```bash
# 全局热键功能
pip install keyboard

# 按键模拟和文本发送
pip install pyautogui

# Windows平台功能增强
pip install pywin32

# 网络请求（用于输入输出脚本）
pip install requests

# 系统信息获取（用于输入输出脚本）
pip install psutil
```

### 运行程序
```bash
python main.py
```

## 📖 功能详细说明

### 1. 🎯 悬浮按钮系统

悬浮按钮是程序的核心入口，提供以下功能：

- **拖拽移动**: 长按悬浮按钮可拖拽到屏幕任意位置
- **边缘吸附**: 拖拽到屏幕边缘会自动吸附
- **透明度控制**: 空闲时半透明，激活时完全不透明
- **全局热键**: 默认 `Ctrl+Alt+Q` 快速切换面板显示
- **右键菜单**: 退出程序和设置选项

### 2. 📱 多层级动作面板

动作面板支持灵活的层级组织：

- **主面板**: 顶级动作面板，包含所有根动作
- **子面板**: 可创建无限层级的子面板（最大5层）
- **面板导航**: 自动生成返回按钮，便于层级导航
- **动作排序**: 支持拖拽排序调整动作顺序

#### 面板操作
- **添加动作**: 点击 "+" 按钮选择动作类型
- **配置管理**: 点击 "⚙" 按钮进行配置操作
- **返回上级**: 子面板中点击"返回"按钮

### 3. 🔧 动作类型系统

#### 基础动作类型

1. **模拟按键**
   - 支持组合键：`ctrl+c`, `alt+tab`
   - 支持单个按键：`f5`, `enter`, `space`
   - 支持文本串：`"hello world"`
   - 支持延时等待：`wait(1000)` (毫秒)
   - 支持序列组合：`ctrl+c, wait(500), "text", enter`

2. **运行程序**
   - 启动指定的程序或文件
   - 支持命令行参数
   - 支持相对路径和绝对路径

3. **打开网址**
   - 在默认浏览器中打开指定网址
   - 支持HTTP/HTTPS协议
   - 支持本地文件路径

4. **发送文本**
   - 在当前活动窗口输入指定文本
   - 自动切换到上一个活动窗口
   - 支持长文本和特殊字符

5. **新建子页面**
   - 创建包含子动作的面板
   - 支持层级组织
   - 独立的动作配置

#### 高级动作类型

6. **输入输出脚本**

强大的Python脚本引擎，支持复杂的自动化任务：

**输入源支持**：
- 剪贴板内容：自动获取剪贴板文本
- 鼠标选中文本：模拟Ctrl+C获取选中文本
- 手动输入：弹窗让用户输入
- 无输入：脚本自行获取数据

**输出目标支持**：
- 发送文本：直接输入到当前窗口
- 打开网址：在浏览器中打开结果URL
- 复制到剪贴板：结果保存到剪贴板
- 保存到文件：保存为时间戳命名的文件
- 显示窗口：在对话框中显示结果

**脚本示例**：
```python
def process(input_text, input_source, output_target):
    """
    处理函数
    
    Args:
        input_text (str): 输入文本
        input_source (str): 输入源类型
        output_target (str): 输出目标类型
    
    Returns:
        str: 处理结果
    """
    # 文本大写转换示例
    result = input_text.upper()
    return result
```

7. **快捷发送功能**

管理常用文本和快捷键信息的专门功能：

**核心特性**：
- 多文件管理：支持分类管理不同类型的快捷内容
- 智能搜索：实时搜索和模糊搜索
- 拖拽排序：支持项目重新排序
- 双击编辑：双击文本区域直接编辑内容
- 右键操作：编辑按钮文字、设置悬浮提示、删除项目
- 自动保存：所有操作自动保存，无需手动保存

**数据格式**：
```json
[
  {
    "key": "110",
    "text": "报警电话",
    "tooltip": "紧急联系方式"
  }
]
```

**使用方式**：
- 点击发送按钮：将key值发送到上一个活动窗口并复制到剪贴板
- 支持悬浮提示：鼠标悬停显示详细信息
- 独立文件管理：每个快捷发送动作对应独立的JSON文件

### 4. 🎨 图标管理系统

完整的SVG图标管理功能：

- **图标库**: 内置10个常用SVG图标
- **自定义图标**: 支持添加自定义SVG图标到 `svg/` 目录
- **图标预览**: 可视化的图标选择界面
- **图标缓存**: 自动缓存提高加载性能
- **动态更新**: 支持运行时添加新图标

#### 图标要求
- 格式：SVG文件
- 推荐尺寸：32x32像素
- 支持 `currentColor` 属性以适应主题色

### 5. 🖱️ 右键菜单系统

动作按钮支持丰富的右键操作：

- **重命名**: 修改动作名称
- **更改图标**: 选择新的SVG图标
- **编辑动作**: 修改动作配置参数
- **复制**: 复制动作到全局剪贴板
- **剪切**: 剪切动作到全局剪贴板
- **删除**: 删除动作（需确认）

### 6. 💾 配置管理系统

智能的配置管理功能：

#### 自动备份系统
- **备份文件夹**: 独立的 `config_backups/` 文件夹
- **自动备份**: 配置变化时自动创建备份
- **大小管理**: 默认20MB限制，超出自动清理最旧文件
- **时间戳命名**: `config_backup_YYYYMMDD_HHMMSS.json`

#### 配置恢复功能
- **载入配置**: 从历史备份中恢复配置
- **安全确认**: 恢复前自动备份当前配置
- **格式验证**: 验证备份文件的有效性

#### 配置菜单（⚙按钮）
- 立即保存：强制保存当前配置
- 刷新界面：重新加载界面布局
- 载入配置：从备份文件恢复
- 粘贴：粘贴剪贴板中的动作
- 备份信息：查看备份状态
- 清理备份：手动清理旧备份

### 7. 🔄 复制剪切粘贴系统

跨面板的动作管理功能：

#### 全局剪贴板
- **复制动作**: 右键 → 复制，动作复制到全局剪贴板
- **剪切动作**: 右键 → 剪切，动作移动到全局剪贴板
- **粘贴动作**: ⚙菜单 → 粘贴，从剪贴板粘贴到当前面板

#### 智能特性
- **跨面板支持**: 主面板与子面板间自由复制粘贴
- **防重复机制**: 剪切后自动清空剪贴板
- **ID唯一性**: 粘贴时自动生成新的唯一ID
- **状态显示**: 菜单动态显示剪贴板内容

### 8. ⌨️ 全局热键系统

- **默认热键**: `Ctrl+Alt+Q` 切换面板显示/隐藏
- **自定义热键**: 支持修改配置文件自定义热键
- **权限要求**: Windows系统需要管理员权限

## 🎮 使用指南

### 基本操作流程

1. **启动程序**
   ```bash
   python main.py
   ```

2. **显示面板**
   - 点击悬浮按钮
   - 按 `Ctrl+Alt+Q` 热键

3. **创建动作**
   - 点击面板中的 "+" 按钮
   - 选择动作类型
   - 配置动作参数

4. **管理动作**
   - 右键动作按钮进行编辑
   - 拖拽调整动作顺序
   - 使用复制粘贴跨面板管理

### 高级功能使用

#### 创建输入输出脚本

1. 点击 "+" → 选择"输入输出"
2. 输入动作名称和描述
3. 选择输入源和输出目标
4. 编写Python处理脚本
5. 保存并测试

#### 使用快捷发送功能

1. 点击 "+" → 选择"快捷发送"
2. 输入动作名称（如"常用密码"）
3. 在快捷发送面板中添加项目
4. 双击编辑文本内容
5. 点击发送按钮使用

#### 配置管理操作

1. 点击⚙按钮打开配置菜单
2. 选择"备份信息"查看备份状态
3. 选择"载入配置"恢复历史配置
4. 使用"清理备份"管理存储空间

## 🔧 配置文件说明

### 主配置文件 (config.json)

```json
{
  "floating_button": {
    "size": 66,
    "snap_margin": 0,
    "idle_opacity": 0.6,
    "active_opacity": 1.0,
    "style": {
      "background": "qlineargradient(...)",
      "color": "white"
    }
  },
  "action_panel": {
    "width": 300,
    "height": 375,
    "columns": 4,
    "background_color": "rgba(240, 240, 240, 0.8)"
  },
  "action_buttons": {
    "size": 66,
    "spacing": 0,
    "style": {
      "background_color": "#f8fbff",
      "border": "1px solid #4f7cff",
      "border_radius": 12
    }
  },
  "hotkeys": {
    "toggle_panel": "ctrl+alt+q"
  },
  "actions": [
    // 动作配置数组
  ]
}
```

### 动作配置格式

```json
{
  "id": "唯一标识符",
  "name": "动作名称",
  "type": "动作类型",
  "icon_path": "图标路径",
  "hotkey": "快捷键",
  "created_at": "创建时间",
  "enabled": true,
  // 特定类型的配置
  "command": "命令或按键序列",
  "url": "网址",
  "text": "文本内容",
  "script_file": "脚本文件名",
  "filename": "快捷发送文件名"
}
```

## 🛠️ 开发扩展

### 模块说明

- **config_manager.py**: 配置文件的加载、保存和管理
- **icon_manager.py**: SVG图标的加载和缓存
- **button_widget.py**: 可拖拽的动作按钮组件
- **action_panel.py**: 动作面板，支持多层级和拖拽排序
- **floating_button.py**: 主悬浮按钮，支持拖拽和热键
- **input_output_dialog.py**: 输入输出动作创建界面
- **quick_send_panel.py**: 快捷发送管理面板
- **script_editor_dialog.py**: 脚本编辑器

### 添加新动作类型

1. 在 `config_manager.py` 中添加动作配置支持
2. 在 `action_panel.py` 中添加动作执行逻辑
3. 在 `button_widget.py` 中添加图标映射
4. 创建对应的配置对话框

### 自定义图标

1. 将SVG文件放入 `svg/` 目录
2. 在动作管理中选择 "更改图标"
3. 从列表中选择新添加的图标

## 📈 性能优化

### 启动优化
- 延迟加载非必需模块
- 图标缓存机制
- 配置文件压缩

### 运行时优化
- 事件驱动架构
- 最小化窗口切换开销
- 智能配置保存策略

### 内存管理
- 及时释放未使用资源
- 图标缓存大小限制
- 配置备份大小管理

## 🐛 故障排除

### 常见问题

1. **程序无法启动**
   - 检查Python版本（需要3.8+）
   - 确认PySide6已正确安装
   - 检查配置文件格式

2. **热键不生效**
   - Windows需要管理员权限
   - 检查keyboard库是否安装
   - 确认热键没有冲突

3. **按键模拟失败**
   - 安装pyautogui库
   - 检查目标应用程序权限
   - 确认窗口切换功能正常

4. **脚本执行错误**
   - 检查Python语法
   - 确认导入的库已安装
   - 查看控制台错误信息

### 调试方法

1. **查看控制台输出**: 运行时关注终端输出的调试信息
2. **检查日志文件**: 查看错误和警告信息
3. **配置文件验证**: 确保JSON格式正确
4. **权限检查**: 确保文件读写权限正常

## 🔒 安全注意事项

1. **脚本安全**: 运行前请仔细检查输入输出脚本内容
2. **权限控制**: 避免执行需要管理员权限的危险操作
3. **网络安全**: 谨慎处理网络请求和数据传输
4. **文件安全**: 注意文件读写权限和路径安全
5. **依赖安全**: 确保第三方库来源可靠

## 📄 版本历史

### v2.0 (当前版本) - 重构版本
- ✅ 完全重构代码架构，模块化设计
- ✅ 新增输入输出脚本引擎
- ✅ 新增快捷发送功能
- ✅ 实现复制剪切粘贴系统
- ✅ 完善配置备份和恢复机制
- ✅ 优化界面布局和用户体验
- ✅ 增强错误处理和稳定性

### 主要改进
- 🔧 模块化架构：从单文件2268行重构为多模块
- 🎨 图标系统：完整的SVG图标管理
- 🖱️ 右键菜单：重命名、修改图标、复制粘贴
- 🔄 配置管理：自动备份、版本控制、一键恢复
- 🐍 脚本引擎：强大的Python自动化脚本系统
- 🚀 快捷发送：专业的快捷文本管理工具

## 🤝 贡献指南

### 欢迎贡献

我们欢迎各种形式的贡献：

1. **问题反馈**: 提交Issue报告Bug或建议新功能
2. **代码贡献**: 提交Pull Request改进代码
3. **文档完善**: 改进文档和使用说明
4. **功能扩展**: 开发新的动作类型或插件

### 贡献方式

1. Fork本项目
2. 创建功能分支
3. 提交代码更改
4. 编写测试用例
5. 提交Pull Request

### 代码规范

- 遵循PEP8代码风格
- 添加类型注解
- 编写完整的文档字符串
- 包含必要的异常处理

## 📝 许可证

MIT License - 详见LICENSE文件

## 🙏 致谢

感谢所有为这个项目做出贡献的开发者和用户。

---

**Quicker - 让您的桌面操作更加高效！** 🚀